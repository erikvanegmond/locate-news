$(document).ready(function(){function e(e){var t="<table class='table table-condensed table-hover' id='articleTable'><thead><tr><th class='col-date'>Datum</th><th class='col-link'>Titel</th></tr></thead><tbody>";e.forEach(function(e){t+="<tr><td class='col-date'>"+n[e].date.split(" ")[0]+"</td><td class='col-link'><a href='http://www.nu.nl"+n[e].link+"' target='_blank'>"+n[e].title+"</a></td></tr>"});t+="</tbody></table>";return new Handlebars.SafeString(t)}function m(){d3.json("data.json",function(n){var s;var o=false;v.selectAll("path").attr("class",function(e){if(t){return"q"+l(f(e.properties.relativeArticleCount))}else{return"q"+l(f(e.properties.articleCount))}}).on("click",function(t){if(s){s.style("opacity","")}d3.select(this).style("opacity",1);s=d3.select(this);var n=$("#dataTable").html();var i=Handlebars.compile(n);var u=i({d:t.properties,artikelen:e(t.properties.articles)});r.html(u).show();o=true}).on("mouseover",function(e){d3.select(this).style("opacity",1);var t=$("#HBTooltip").html();var n=Handlebars.compile(t);var r=n({d:e.properties});i.html(r).show()}).on("mouseout",function(e){if(o){o=false;$("#articleTable").addClass("Test");var t=document.getElementById("articleTable");sorttable.makeSortable(t);var n=document.getElementsByTagName("th")[0];sorttable.innerSortFunction.apply(n,[])}d3.select(this).style("opacity","");i.hide()}).on("mousemove",function(){i.css("top",event.pageY-10+"px").css("left",event.pageX+10+"px")});})}$("#mapToggle button").click(function(){$(this).addClass("active").siblings().removeClass("active");if($(this).attr("id")=="map1"){l=d3.scale.quantile().domain([-4.5,-1]).range(d3.range(9));t=true}else{l=d3.scale.quantile().domain([0,3.2]).range(d3.range(9));t=false}m()});var t=true;var n;$.getJSON("articlesData.json",function(e){n=e});var r=$("div#dataTableContainer");var i=$("div#tooltipContainer");var s=$("#dataTable").html();var o=Handlebars.compile(s);var u={articleCount:"Geen plaats geselecteerd",GM_NAAM:"Geen plaats geselecteerd",population:"Geen plaats geselecteerd",relativeArticleCount:"Geen plaats geselecteerd"};var a=o({d:u,artikelen:"Geen plaats geselecteerd"});r.html(a).show();var f=d3.scale.log();var l=d3.scale.quantile().domain([-4.5,-1.4]).range(d3.range(9));var c=d3.geo.mercator();var h=d3.geo.path().projection(c);var p=c.translate();p[0]=-550;p[1]=10620;c.translate(p);c.scale(6e4);var d=d3.select("#chart").append("svg").attr("id","svgoriginal");var v=d.append("g");d3.json("data.json",function(n){var s;var o=false;v.selectAll("path").data(n.features).enter().append("path").attr("d",h).attr("class",function(e){if(t){return"q"+l(f(e.properties.relativeArticleCount))}else{return"q"+l(f(e.properties.articleCount))}}).on("click",function(t){if(s){s.style("opacity","")}d3.select(this).style("opacity",1);s=d3.select(this);var n=$("#dataTable").html();var i=Handlebars.compile(n);var u=i({d:t.properties,artikelen:e(t.properties.articles)});r.html(u).show();o=true}).on("mouseover",function(e){d3.select(this).style("opacity",1);var t=$("#HBTooltip").html();var n=Handlebars.compile(t);var r=n({d:e.properties});i.html(r).show()}).on("mouseout",function(e){if(o){o=false;$("#articleTable").addClass("Test");var t=document.getElementById("articleTable");sorttable.makeSortable(t);var n=document.getElementsByTagName("th")[0];sorttable.innerSortFunction.apply(n,[])}d3.select(this).style("opacity","");i.hide()}).on("mousemove",function(){i.css("top",event.pageY-10+"px").css("left",event.pageX+10+"px")});})})